---
import "../styles/global.css";
import "../styles/fullcalendar.css";

import Sidebar from "@/layouts/sidebar.astro";
import CalendarHeader from "@/layouts/calendar/calendar-header.astro";
import FullCalendarWrapper from "@/components/ui/full-calendar-wrapper.tsx";
import { demoEvents } from "@/mocks/event-mock";
// Full Astro Component Syntax:
// https://docs.astro.build/basics/astro-components/

// Création des dates pour les événements
const today = new Date();
const tomorrow = new Date();
tomorrow.setDate(today.getDate() + 1);
const inThreeDays = new Date();
inThreeDays.setDate(today.getDate() + 3);

// Variables pour coordonner les composants
const initialDate = new Date();
const initialView = "week";
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro Calendar</title>
	</head>

	<body class="font-sans">
		<div class="bg-black flex h-screen p-4">
			<Sidebar />
			<div class="p-1"></div>
			<div class="bg-white rounded-3xl flex flex-col h-full w-full">
				<div id="calendar-container" class="flex flex-col h-full">
					<CalendarHeader selectedDate={initialDate} currentView={initialView} />
					<div class="py-4"/>
					<div class="py-6 bg-gray-100"/>
					<div class="flex-grow">
						<FullCalendarWrapper client:load initialEvents={demoEvents} />
					</div>
				</div>
			</div>
		</div>
	</body>
</html>

<script is:inline>
	// Script pour synchroniser les composants Astro et React
	document.addEventListener('DOMContentLoaded', function() {
		// Log des événements pour debug
		window.addEventListener('fullcalendar:date-change', function(e) {
			console.log('Calendar date changed:', e.detail);
		});

		window.addEventListener('fullcalendar:view-change', function(e) {
			console.log('Calendar view changed:', e.detail);
		});
		
		window.addEventListener('toggle-group:value-change', function(e) {
			console.log('Toggle group value changed:', e.detail);
		});
		
		window.addEventListener('astro:calendar-prev', function() {
			console.log('Calendar prev clicked');
		});
		
		window.addEventListener('astro:calendar-next', function() {
			console.log('Calendar next clicked');
		});
		
		window.addEventListener('astro:calendar-today', function() {
			console.log('Calendar today clicked');
		});
	});
</script>
